FGO.minimize_manager=function(){var quest_list={},target_items={},item2quest_list={},event_status={},quest_manager=null;const LP_failed_limit=10;let LP_failed_times;var quest_table=[],quest_table_index=null,quest_table_length=null,PSO_finish_state=null,AP=null,LP_result_collection=[],PSO_result_collection=[],result_callback=null,PSO_result_callback=null,PSO_obj={target_items:null,best:null},PSO,LP_worker,PSO,LP_worker;FGO.isWebSite?((PSO=new Worker("/FGO/release/FGO.js/FGO.PSO.min.js?"+FGO.ver)).onmessage=function(e){check_PSO_team_finish(e.data)},(LP_worker=new Worker("/FGO/release/LP_worker.min.js?"+FGO.ver)).onmessage=function(e){check_LP_team_finish(e.data)}):((PSO=new Worker("release/FGO.js/FGO.PSO.js?"+FGO.ver)).onmessage=function(e){check_PSO_team_finish(e.data)},(LP_worker=new Worker("release/LP_worker.js?"+FGO.ver)).onmessage=function(e){check_LP_team_finish(e.data)});function set_quest_manager(manager){quest_manager=manager}function set_event_status(event){event_status=event,quest_manager.set_event(event)}function set_target_item_list(list){target_items=list,quest_list=quest_manager.get_specify_quest_list({get_CP:!1,schedule:!0,item:!0,event:!0}),item2quest_list=quest_manager.get_specify_item2quest_list({get_CP:!1,schedule:!0,item:!0,event:!0}),set_item2quest_list()}function set_item2quest_list(){var tmp_list={};for(var name in target_items)tmp_list[name]=item2quest_list[name];get_quest_table(tmp_list)}function get_quest_table(item2quest_list){var list=item2quest_list,queue={item_list:[],quest_list:[]},quest_record={},item_has_team={},team=[],team_list=[],type1,type2,item;for(item in list)item_has_team[item]=!1;for(item in list)item_has_team[item]||(queue.item_list=[],queue.quest_list=[],team=[],queue.item_list.push(item),create_team(),team_list.push(team));function create_team(){for(var finish=!1,item,type,quest,i,j;!finish;){for(i in queue.item_list)for(j in item=queue.item_list[i],item2quest=list[item],team.push(item),item_has_team[item]||(item_has_team[item]=!0),item2quest)type=item2quest[j].type,quest_record[type[0]]&&quest_record[type[0]][type[1]]||(quest_record[type[0]]||(quest_record[type[0]]={}),quest_record[type[0]][type[1]]=1,queue.quest_list.push(type));if(0===queue.item_list.length)finish=!0;else for(i in queue.item_list=[],queue.quest_list)for(item in type=queue.quest_list[i],(quest=quest_list[type[0]][type[1]]).drop_list)target_items[item]&&!item_has_team[item]&&(item_has_team[item]=!0,queue.item_list.push(item))}}for(var tmp_quest_list={},i,j,item,quest,tmp_table=[],type1,type2,has_quest;quest_table.length;)quest_table.pop();for(team in team_list){for(i in has_quest=!1,tmp_quest_list={},tmp_table=[],team_list[team])for(j in item=team_list[team][i],list[item])tmp_quest_list[(quest=list[item][j]).type[0]]||(tmp_quest_list[quest.type[0]]={}),tmp_quest_list[quest.type[0]][quest.type[1]]||(tmp_quest_list[quest.type[0]][quest.type[1]]=1);for(type1 in tmp_quest_list)for(type2 in tmp_quest_list[type1])tmp_table.push([type1,type2]),has_quest=!0;if(has_quest)quest_table.push({item_list:team_list[team],quest_list:tmp_table});else var debug=0}}function get_result(callback){result_callback=callback,LP_failed_times=0,get_LP_result()}function get_LP_result(){quest_table_index=0,quest_table_length=quest_table.length,LP_result_collection.length=0,quest_table_length?start_LP():result_callback&&result_callback({times_list:{},AP:0,item_list:{}})}function start_LP(){var index,item,team_target_item={};for(index in quest_table[quest_table_index].item_list)team_target_item[item=quest_table[quest_table_index].item_list[index]]=target_items[item];if(quest_table[quest_table_index].quest_list.length){var data=get_LP_data({team:quest_table[quest_table_index],quest_list:quest_list,item2quest_list:item2quest_list,target_items:team_target_item,event:event_status});LP_worker.postMessage({data:data,ver:FGO.ver,isWebSite:FGO.isWebSite})}}function end_LP(){var result,tmp_arr,times,quest_index,type,tmp_quest_times_list={},base_times_list={},less_best_times_list={},debug_less_best_times_list={},base_item_list,enough=!0,tmp_result;for(var index1 in LP_result_collection)for(var index2 in tmp_arr=(result=LP_result_collection[index1]).match(/q\d+ = [\d\/]+/g))quest_index=Number(tmp_arr[index2].match(/\d+/gi)[0]),(times=getNum(tmp_arr[index2].replace(/q\d+ = /,"")))&&(tmp_quest_times_list[(type=quest_table[index1].quest_list[quest_index])[0]]||(tmp_quest_times_list[type[0]]={},base_times_list[type[0]]={},less_best_times_list[type[0]]={},debug_less_best_times_list[type[0]]={}),tmp_quest_times_list[type[0]][type[1]]=times,base_times_list[type[0]][type[1]]=Math.floor(times),less_best_times_list[type[0]][type[1]]=Math.ceil(times)-base_times_list[type[0]][type[1]],debug_less_best_times_list[type[0]][type[1]]=Math.ceil(times));function getNum(str){var arr=str.split("/");return 2===arr.length?arr[0]/arr[1]:Number(arr)}var isFailed=!1;if(LP_failed_times<LP_failed_limit){var ceil_result=quest_manager.get_played_result(debug_less_best_times_list,event_status);for(var item in ceil_result.item_list)if(ceil_result.item_list[item]<target_items[item]){isFailed=!0;break}isFailed&&(LP_failed_times+=1,setTimeout(get_LP_result,0))}else console.log("LP-solve failed "+LP_failed_limit+"times.");if(!isFailed){base_item_list=quest_manager.get_played_result_items(base_times_list);var new_target_item_list={},value;for(var item in target_items)(value=target_items[item]-base_item_list[item])>0&&(new_target_item_list[item]=value,enough&&(enough=!1));PSO_obj.target_items=new_target_item_list,PSO_obj.best=less_best_times_list,enough?(tmp_result=quest_manager.get_played_result(base_times_list,event_status),result_callback&&result_callback({times_list:base_times_list,AP:tmp_result.AP,item_list:tmp_result.item_list})):get_PSO_result(function(){for(var i in PSO_result_collection)for(var type1 in PSO_result_collection[i].quest_times)for(var type2 in PSO_result_collection[i].quest_times[type1])PSO_result_collection[i].quest_times[type1][type2]>0&&(base_times_list[type1]||(base_times_list[type1]={}),base_times_list[type1][type2]=base_times_list[type1][type2]?base_times_list[type1][type2]:0,base_times_list[type1][type2]+=PSO_result_collection[i].quest_times[type1][type2]);tmp_result=quest_manager.get_played_result(base_times_list,event_status),result_callback&&result_callback({times_list:base_times_list,AP:tmp_result.AP,item_list:tmp_result.item_list})})}}function get_LP_data(obj){var str_arr=[],tmp_arr,integer_arr=[],AP,questArr,item,p,index1,index2;for(index1 in str_arr.push("Minimize "),tmp_arr=[],obj.team.quest_list)questArr=obj.team.quest_list[index1],AP=obj.quest_list[questArr[0]][questArr[1]].AP,tmp_arr.push(AP+"Q"+index1),integer_arr.push("Q"+index1);for(index1 in str_arr.push(tmp_arr.join("+")),str_arr.push(" subject to \n"),obj.team.item_list){for(index2 in tmp_arr=[],item=obj.team.item_list[index1],obj.team.quest_list)questArr=obj.team.quest_list[index2],(p=obj.quest_list[questArr[0]][questArr[1]].drop_list[item])&&tmp_arr.push(p+"Q"+index2);str_arr.push(tmp_arr.join("+")),str_arr.push(">="+obj.target_items[item]+"\n")}return str_arr.join("")}function check_LP_team_finish(result){LP_result_collection.push(result),(quest_table_index+=1)<quest_table_length?start_LP():end_LP()}function get_PSO_result(callback){var index,item;PSO_result_collection.length=0,quest_table_index=0,PSO_result_callback=callback,start_PSO()}function start_PSO(){var team_target_item={};for(index in quest_table[quest_table_index].item_list)item=quest_table[quest_table_index].item_list[index],team_target_item[item]=PSO_obj.target_items[item];PSO.postMessage({team:quest_table[quest_table_index],quest_list:quest_list,item2quest_list:item2quest_list,target_items:team_target_item,event:event_status,best:PSO_obj.best,isWebSite:FGO.isWebSite})}function check_PSO_team_finish(result){quest_table_index+=1,PSO_result_collection.push(result),quest_table_index<quest_table_length?start_PSO():PSO_result_callback&&PSO_result_callback()}return{set_event_status:set_event_status,set_target_item_list:set_target_item_list,set_quest_manager:set_quest_manager,get_result:get_result}}();