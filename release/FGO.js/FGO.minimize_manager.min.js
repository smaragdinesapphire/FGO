FGO.minimize_manager=function(){function g(n){i=n}function nt(n){e=n;i.set_event(n)}function tt(n){r=n;o=i.get_specify_quest_list({get_CP:!1,schedule:!0,item:!0,event:!0});s=i.get_specify_item2quest_list({get_CP:!1,schedule:!0,item:!0,event:!0});it()}function it(){var n={};for(var t in r)n[t]=s[t];rt(n)}function rt(n){function d(){for(var f=!1,t,n,s,u,a;!f;){for(u in i.item_list){t=i.item_list[u];item2quest=c[t];e.push(t);h[t]||(h[t]=!0);for(a in item2quest)if(n=item2quest[a].type,l[n[0]]&&l[n[0]][n[1]])continue;else l[n[0]]||(l[n[0]]={}),l[n[0]][n[1]]=1,i.quest_list.push(n)}if(i.item_list.length===0)f=!0;else{i.item_list=[];for(u in i.quest_list){n=i.quest_list[u];s=o[n[0]][n[1]];for(t in s.drop_list)r[t]&&!h[t]&&(h[t]=!0,i.item_list.push(t))}}}}var c=n,i={item_list:[],quest_list:[]},l={},h={},e=[],a=[],f,b,k,u,s,v,y,w,p,g;for(u in c)h[u]=!1;for(u in c)h[u]||(i.item_list=[],i.quest_list=[],e=[],i.item_list.push(u),d(),a.push(e));for(f={},v=[];t.length;)t.pop();for(e in a){p=!1;f={};v=[];for(b in a[e]){u=a[e][b];for(k in c[u])s=c[u][k],f[s.type[0]]||(f[s.type[0]]={}),f[s.type[0]][s.type[1]]||(f[s.type[0]][s.type[1]]=1)}for(y in f)for(w in f[y])v.push([y,w]),p=!0;p?t.push({item_list:a[e],quest_list:v}):g=0}}function ut(n){f=n;a=0;b()}function b(){n=0;h=t.length;c.length=0;h?k():f&&f({times_list:{},AP:0,item_list:{}})}function k(){var u,i,f={},h;for(u in t[n].item_list)i=t[n].item_list[u],f[i]=r[i];t[n].quest_list.length&&(h=et({team:t[n],quest_list:o,item2quest_list:s,target_items:f,event:e}),y.postMessage({data:h,ver:FGO.ver}))}function ft(){function ct(n){var t=n.split("/");return t.length===2?t[0]/t[1]:Number(t)}var et,y,h,ot,n,k={},o={},d={},g={},ht,nt=!0,v,tt,it,w,rt,ut,ft,s;for(tt in c){et=c[tt];y=et.match(/q\d+ = [\d\/]+/g);for(it in y)ot=Number(y[it].match(/\d+/ig)[0]),h=ct(y[it].replace(/q\d+ = /,"")),h&&(n=t[tt].quest_list[ot],k[n[0]]||(k[n[0]]={},o[n[0]]={},d[n[0]]={},g[n[0]]={}),k[n[0]][n[1]]=h,o[n[0]][n[1]]=Math.floor(h),d[n[0]][n[1]]=Math.ceil(h)-o[n[0]][n[1]],g[n[0]][n[1]]=Math.ceil(h))}if(w=!1,a<p){rt=i.get_played_result(g,e);for(s in rt.item_list)if(rt.item_list[s]<r[s]){w=!0;break}w&&(a+=1,setTimeout(b,0))}else console.log("LP-solve failed "+p+"times.");if(!w){ht=i.get_played_result_items(o);ut={};for(s in r)ft=r[s]-ht[s],ft>0&&(ut[s]=ft,nt&&(nt=!1));l.target_items=ut;l.best=d;nt?(v=i.get_played_result(o,e),f&&f({times_list:o,AP:v.AP,item_list:v.item_list})):st(function(){var r,n,t;for(r in u)for(n in u[r].quest_times)for(t in u[r].quest_times[n])u[r].quest_times[n][t]>0&&(o[n]||(o[n]={}),o[n][t]=o[n][t]?o[n][t]:0,o[n][t]+=u[r].quest_times[n][t]);v=i.get_played_result(o,e);f&&f({times_list:o,AP:v.AP,item_list:v.item_list})})}}function et(n){var t=[],i,h=[],s,r,f,e,u,o;t.push("Minimize ");i=[];for(u in n.team.quest_list)r=n.team.quest_list[u],s=n.quest_list[r[0]][r[1]].AP,i.push(s+"Q"+u),h.push("Q"+u);t.push(i.join("+"));t.push(" subject to \n");for(u in n.team.item_list){i=[];f=n.team.item_list[u];for(o in n.team.quest_list)r=n.team.quest_list[o],e=n.quest_list[r[0]][r[1]].drop_list[f],e&&i.push(e+"Q"+o);t.push(i.join("+"));t.push(">="+n.target_items[f]+"\n")}return t.join("")}function ot(t){c.push(t);n+=1;n<h?k():ft()}function st(t){u.length=0;n=0;v=t;d()}function d(){var i={};for(index in t[n].item_list)item=t[n].item_list[index],i[item]=l.target_items[item];w.postMessage({team:t[n],quest_list:o,item2quest_list:s,target_items:i,event:e,best:l.best})}function ht(t){n+=1;u.push(t);n<h?d():v&&v()}var o={},r={},s={},e={},i=null,y;const p=10;let a;var t=[],n=null,h=null,c=[],u=[],f=null,v=null,l={target_items:null,best:null},w=new Worker("release/FGO.js/FGO.PSO.js?"+FGO.ver);return w.onmessage=function(n){ht(n.data)},y=new Worker("/release/LP_worker.js?"+FGO.ver),y.onmessage=function(n){ot(n.data)},{set_event_status:nt,set_target_item_list:tt,set_quest_manager:g,get_result:ut}}();