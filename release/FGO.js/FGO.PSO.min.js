self.addEventListener("message",function(n){function v(){var n,i,f={},r,e={};for(n in t)for(u[n]=[],f[n]=e[n]=0,r=t[n].length,i=0;i<r;i+=1)f[n]+=t[n][i].CP;for(n in t)for(r=t[n].length,i=0;i<r;i+=1)e[n]+=t[n][i].CP/f[n],u[n][i]=e[n];return}function f(n,t){for(var r,u={},i=0,f=t.quest_list.length;i<f;i+=1)r=t.quest_list[i],u[r[0]]||(u[r[0]]={}),u[r[0]][r[1]]=n[i];return u}var s,c,l,e;typeof JIE=="undefined"&&(importScripts("/FGO/release/JIE.js/JIE.min.js"),importScripts("/FGO/release/JIE.js/JIE.base.min.js"),importScripts("/FGO/release/JIE.js/JIE.math.min.js"),importScripts("/FGO/release/JIE.js/JIE.optimization/JIE.optimization.PSO.min.js"),importScripts("/FGO/release/FGO.js/FGO.min.js"),importScripts("/FGO/release/FGO.js/FGO.info_manager.min.js"),importScripts("/FGO/release/FGO.js/FGO.info.min.js"));var i=n.data,h=i.team,o=i.quest_list,t=i.item2quest_list,r=i.target_items,a=i.event,u={};v();s=FGO.info_manager;c=function(n){function h(){var t={};return t.length=n.quest_list.length,t.get_fit=function(){var t=f(arguments,n);return s.get_played_result_AP(t,a)},t}function c(){var s=[],u,h,f,t,e,i,c;for(h in n.quest_list){u=n.quest_list[h];f=o[u[0]][u[1]];t=null;for(c in n.item_list)i=n.item_list[c],f.drop_list[i]&&(e=Math.ceil(r[i]/f.drop_list[i]),(!t||t<e)&&(t=e));s.push({min:0,max:t})}return s}function l(){for(var u=[],r,t=0,f=n.quest_list.length;t<f;t+=1)r=Math.ceil(i.bound[t].max/10),r<10&&(r=i.bound[t].max),u.push(r);return u}function e(i,e,h){var l,v,p,y={},w,a=[],c;JIE.base.extend(a,i);for(l in a)a[l]<e[l].min&&(a[l]=e[l].min),a[l]>e[l].max&&(a[l]=e[l].max);y=s.get_played_result_items(f(a,n));for(c in r)if((y[c]||0)<r[c]){if(!t[c]||!t[c].length)continue;if(w=r[c]-(y[c]||0),h)v=t[c][0].type;else{v=b(c);function b(){for(var r=Math.random(),i=u[c].length,n=0;n<i;n+=1)if(r<u[c][n])return t[c][n].type;return t[c][i-1].type}}p=o[v[0]][v[1]];for(l in n.quest_list)if(n.quest_list[l].toString()===v.toString()){a[l]+=Math.ceil(w/p.drop_list[c]);break}}return a}function v(){var r=[],s,t,u;for(s in n.quest_list)r.push(0);return t=e(r,i.bound,!0),u=function(n){var r=0,u=null,t,i,f;for(t in n)for(i in n[t])u=o[t][i],f=n[t][i],r+=u.AP*f;return r}(f(t,n)),{args:t,fit:u}}var i={};return i.fn=h(),i.bound=c(),i.v_max=l(),i.fixed_method=e,i.is_integer=!0,i.is_minimazation=!0,i.g_best=v(),i.p_max=40,i.iter_max=4e3,i.no_change_limit=40,i.c1=.5,i.c2=2,i}(h);l=new JIE.optimization.PSO(c);e=l.play();e.quest_times=f(e.args,h);self.postMessage(e)},!1);