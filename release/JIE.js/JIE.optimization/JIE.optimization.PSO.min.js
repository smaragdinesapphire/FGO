JIE.optimization.PSO=function(n){this.options={fn:null,w:1,c1:2,c2:2,v_max:null,p_max:50,iter_max:100,bound:null,fixed_method:null,is_integer:!1,is_minimazation:!0,first_gen:null,advanced_search:null,g_best:null,no_change_limit:null};JIE.base.marge(this.options,n);this._ans=null};JIE.optimization.PSO.prototype.set=function(n){JIE.base.marge(this.options,n)};JIE.optimization.PSO.prototype.play=function(){var t;if(!this.options.fn||!this.options.bound||!this.options.fixed_method)return JIE.isDebug&&alert("Please check the PSO's options"),!1;for(var c=this.options.fixed_method,h=this.options.fn,g=this.options.p_max,u=this.options.bound,nt=this.options.is_integer,tt=this.options.is_minimazation,a=this.options.v_max,it=this.options.first_gen,rt=this.options.w,ut=this.options.c1,ft=this.options.c2,et=this.options.advanced_search,f=this.options.g_best,w=this.options.no_change_limit,b,ot,e=[],r,t,v=0,k,l=[],d,o,s=[],i,y=h.length,p,n=0;n<g;n++){if(it===null)for(r=[],t=0;t<y;t++)p=JIE.isDebug?(u[t].max-u[t].min)*rand()+u[t].min:(u[t].max-u[t].min)*Math.random()+u[t].min,nt&&(p=Math.round(p)),r.push(p);else r=it[n];if(e[n]=r,c)i=c(r,u),i.fit===undefined&&(i={args:i,fit:h.get_fit.apply(this,i)});else{for(n=0;n<u.length;n++)r[n]<u[n].min&&(r[n]=u[n].min),r[n]>u[n].max&&(r[n]=u[n].max);i={args:r,fit:h.get_fit.apply(this,r)}}for(s[n]=i,f===null?f=i:tt?i.fti<f.fit&&(f=i):i.fit>f.fit&&(f=i),k=f.fit,d=[],t=0;t<y;t++)d.push(0);l[n]=d}for(b=0,ot=this.options.iter_max;b<ot;b++){for(n=0;n<g;n++){for(r=[],t=0;t<y;t++)o=JIE.isDebug?rt*l[n][t]+ut*rand()*(s[n].args[t]-e[n][t])+ft*rand()*(f.args[t]-e[n][t]):rt*l[n][t]+ut*Math.random()*(s[n].args[t]-e[n][t])+ft*Math.random()*(f.args[t]-e[n][t]),o>a[t]?o=a[t]:o<-a[t]&&(o=-a[t]),l[n][t]=o,r[t]=e[n][t]+o,nt&&(r[t]=Math.round(r[t]));if(c)i=c(r,u),i.fit===undefined&&(i={args:i,fit:h.get_fit.apply(this,i)});else for(n=0;n<u.length;n++)r[n]<u[n].min&&(r[n]=u[n].min),r[n]>u[n].max&&(r[n]=u[n].max);if(et&&w-v<=3&&Math.abs(f.fit-i.fit)<=100)for(i.args=et(i.args,h,c),i.fit=h.get_fit.apply(this,i.args),t=0;t<y;t++)i.args[t]!==e[t]&&(l[n][t]=i.args[t]-e[n][t]);e[n]=i.args;tt?(i.fit<s[n].fit&&(s[n]=i),i.fit<f.fit&&(f=i)):(i.fit>s[n].fit&&(s[n]=i),i.fit>f.fit&&(f=i))}if(w)if(k!==f.fit)k=f.fit,v=0;else if(v+=1,v===w)break}return f};