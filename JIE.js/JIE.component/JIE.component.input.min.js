JIE.component.input=function(){this.onError=new JIE.event.Publisher("error",this);this.onChange=new JIE.event.Publisher("change",this);JIE.component.input.uber.constructor.call(this)};JIE.base.inherit(JIE.component.input,JIE.component.control_base,{prepareNode:function(n){var t=this;this._body=n;this._input=NewObj("div","input");this._view=NewObj("div","view");this._value=0;this._default_value=0;this._mode="input";n.appendChild(this._input);n.className="input_box";this._input.setAttribute("contenteditable",!0);this._input.obj=this;this._input.textContent=this._default_value;this._input.onkeydown=function(){if(!t.set_value())return!1};JIE.event.listener.add(this._input,"focus",function(){t._input.textContent=""});JIE.event.listener.add(this._input,"blur",function(){var n=t._input.textContent;n===""?t._input.textContent=t._value:t._value!==n&&(t._value=n,t.onChange.fire(Number(n)))})},get_value:function(){return this._value},set_value:function(n){if(this._modify){var t=this._modify(n);return t?(this._input.textContent=this._value=t.value,!0):(event.cancelBubble=!0,event.returnValue=!1,!1)}return this._input.textContent=this._value=n,!0},reset:function(){this._input.textContent=this._value=this._default_value},set_mode:function(n){if(typeof n=="string"){var t=n.toLocaleLowerCase();switch(t){case"input":this._mode==="view"&&(this._body.appendChild(this._input),this._body.removeChild(this._view),this._mode="input");break;case"view":this._mode==="input"&&(this._view.textContent=this._input.textContent,this._body.appendChild(this._view),this._body.removeChild(this._input),this._mode="view")}}}});JIE.component.input.factory=function(n){var t=n;return typeof this.factory[t]!="function"&&JIE.debug&&alert("JIE.component.input.factory: input argument "+t+" is fall."),new JIE.component.input[t]};JIE.component.input.Number=function(){JIE.component.input.Number.uber.constructor.call(this);this._regexp=/[^0-9]/};JIE.base.inherit(JIE.component.input.Number,JIE.component.input);JIE.component.input.Number.prototype._modify=function(n){var t=n;if(event){if(event.key&&event.key.length===1){if(this._regexp.test(event.key))return!1;t=event.key}else if(event.pointerType!=="mouse"&&event.keyCode!==8)return!1}else if(this._regexp.test(n))return!1;return this._tmp=t,{value:Number(this._tmp)}};JIE.component.input.Number_lift=function(){JIE.component.input.Number_lift.uber.constructor.call(this)};JIE.base.inherit(JIE.component.input.Number_lift,JIE.component.control_base,{prepareNode:function(n){var i=NewObj("div","up","▲"),r=NewObj("div","down","▼"),t=this;this._body=n;this._input=JIE.component.input.factory("Number");this._input.render(this._body);this._body.appendChild(i);this._body.appendChild(r);JIE.event.listener.add(i,"click",function(){t._input.set_value(t._input.get_value()+1)});JIE.event.listener.add(r,"click",function(){var n=t._input.get_value();n!==0&&t._input.set_value(t._input.get_value()-1)})},get_value:function(){return this._input.get_value()},set_value:function(n){this._input.set_value(n)},reset:function(){this._input.reset()}});