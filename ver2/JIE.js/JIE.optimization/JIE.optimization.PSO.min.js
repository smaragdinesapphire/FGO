JIE.optimization.PSO=function(n){this.options={fn:null,w:1,c1:2,c2:2,v_max:null,p_max:50,iter_max:100,bound:null,fixed_method:null,is_integer:!1,is_minimazation:!0,first_gen:null,advanced_search:null,g_best:null,no_change_limit:null};JIE.base.marge(this.options,n);this._ans=null};JIE.optimization.PSO.prototype.set=function(n){JIE.base.marge(this.options,n)};JIE.optimization.PSO.prototype.play=function(){var n;if(!this.options.fn||!this.options.bound||!this.options.fixed_method)return JIE.isDebug&&alert("Please check the PSO's options"),!1;var y=this.options.fixed_method,l=this.options.fn,nt=this.options.p_max,f=this.options.bound,tt=this.options.is_integer,it=this.options.is_minimazation,a=this.options.v_max,rt=this.options.first_gen,ut=this.options.w,ft=this.options.c1,et=this.options.c2,ot=this.options.advanced_search,u=this.options.g_best,b=this.options.no_change_limit,k,st,e=[],t,r,n,p=0,d,s=[],v,h,o=[],i,g,c=l.length,w;if(u){for(e.push(u.args),o.push(u),v=[],n=0;n<c;n++)v.push(Math.random()*a[n]*(Math.random()>.5?1:-1));s.push(v);t=1}else t=0;for(;t<nt;t++){if(rt===null)for(r=[],n=0;n<c;n++)w=JIE.isDebug?(f[n].max-f[n].min)*rand()+f[n].min:(f[n].max-f[n].min)*Math.random()+f[n].min,tt&&(w=Math.round(w)),r.push(w);else r=rt[t];if(e[t]=r,y)i=y(r,f),i.fit===undefined&&(i={args:i,fit:l.get_fit.apply(this,i)});else{for(t=0;t<f.length;t++)r[t]<f[t].min&&(r[t]=f[t].min),r[t]>f[t].max&&(r[t]=f[t].max);i={args:r,fit:l.get_fit.apply(this,r)}}for(o[t]=i,u===null?u=i:it?i.fit<u.fit&&(u=i):i.fit>u.fit&&(u=i),v=[],n=0;n<c;n++)v.push(Math.random()*a[n]*(Math.random()>.5?1:-1));s[t]=v}for(d=u.fit,k=0,st=this.options.iter_max;k<st;k++){for(t=0;t<nt;t++){for(r=[],n=0;n<c;n++)h=JIE.isDebug?ut*s[t][n]+ft*rand()*(o[t].args[n]-e[t][n])+et*rand()*(u.args[n]-e[t][n]):ut*s[t][n]+ft*Math.random()*(o[t].args[n]-e[t][n])+et*Math.random()*(u.args[n]-e[t][n]),h>a[n]?h=a[n]:h<-a[n]&&(h=-a[n]),s[t][n]=h,r[n]=e[t][n]+h,tt&&(r[n]=Math.round(r[n]));if(y)i=y(r,f),i.fit===undefined&&(i={args:i,fit:l.get_fit.apply(this,i)});else for(t=0;t<f.length;t++)r[t]<f[t].min&&(r[t]=f[t].min),r[t]>f[t].max&&(r[t]=f[t].max);for(g=!1,n=0;n<c;n++)if(r[n]!==i[n]){g=!0;break}if(g)for(n=0;n<c;n++)s[t][n]=i.args[n]-e[t][n];if(ot&&b-p<=3&&Math.abs(u.fit-i.fit)<=100)for(i.args=ot(i.args,l,y),i.fit=l.get_fit.apply(this,i.args),n=0;n<c;n++)i.args[n]!==e[n]&&(s[t][n]=i.args[n]-e[t][n]);e[t]=i.args;it?(i.fit<o[t].fit&&(o[t]=i),i.fit<u.fit&&(u=i)):(i.fit>o[t].fit&&(o[t]=i),i.fit>u.fit&&(u=i))}if(b)if(d!==u.fit)d=u.fit,p=0;else if(p+=1,p===b)break}return u};